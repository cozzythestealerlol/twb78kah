--// Services
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local Workspace = game:GetService("Workspace")
local Lighting = game:GetService("Lighting")

local player = Players.LocalPlayer

--// Function to start the instant steal (SlotPrompt HoldDuration = 0)
local function startInstantSteal()
	local slotPrompts = {}

	local function addPrompt(prompt)
		if prompt and prompt:IsA("ProximityPrompt") and prompt.Name == "SlotPrompt" then
			slotPrompts[prompt] = true
		end
	end

	for _, obj in ipairs(Workspace:GetDescendants()) do
		addPrompt(obj)
	end

	Workspace.DescendantAdded:Connect(addPrompt)

	RunService.Heartbeat:Connect(function()
		for prompt, _ in pairs(slotPrompts) do
			if prompt and prompt.Parent then
				prompt.HoldDuration = 0
			else
				slotPrompts[prompt] = nil
			end
		end
	end)
end

--// Prompt GUI
local function showInstantStealPrompt(callback)
	local promptGui = Instance.new("ScreenGui")
	promptGui.Name = "InstantStealPrompt"
	promptGui.Parent = player:WaitForChild("PlayerGui")

	local promptFrame = Instance.new("Frame")
	promptFrame.Size = UDim2.new(0, 400, 0, 150)
	promptFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
	promptFrame.AnchorPoint = Vector2.new(0.5, 0.5)
	promptFrame.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
	promptFrame.BackgroundTransparency = 0.2
	promptFrame.BorderSizePixel = 0
	promptFrame.Parent = promptGui

	local corner = Instance.new("UICorner")
	corner.CornerRadius = UDim.new(0, 15)
	corner.Parent = promptFrame

	local title = Instance.new("TextLabel")
	title.Parent = promptFrame
	title.Size = UDim2.new(1, -20, 0, 50)
	title.Position = UDim2.new(0, 10, 0, 10)
	title.BackgroundTransparency = 1
	title.TextColor3 = Color3.fromRGB(255, 255, 255)
	title.Font = Enum.Font.GothamBold
	title.TextSize = 22
	title.Text = "Do You Want An Instant Steal? (No Lag)"

	local yesBtn = Instance.new("TextButton")
	yesBtn.Parent = promptFrame
	yesBtn.Size = UDim2.new(0, 150, 0, 40)
	yesBtn.Position = UDim2.new(0.25, -75, 0, 90)
	yesBtn.BackgroundColor3 = Color3.fromRGB(0, 200, 0)
	yesBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
	yesBtn.Font = Enum.Font.GothamBold
	yesBtn.TextSize = 20
	yesBtn.Text = "Yes"
	local yesCorner = Instance.new("UICorner", yesBtn)
	yesCorner.CornerRadius = UDim.new(0, 12)

	local noBtn = Instance.new("TextButton")
	noBtn.Parent = promptFrame
	noBtn.Size = UDim2.new(0, 150, 0, 40)
	noBtn.Position = UDim2.new(0.75, -75, 0, 90)
	noBtn.BackgroundColor3 = Color3.fromRGB(200, 0, 0)
	noBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
	noBtn.Font = Enum.Font.GothamBold
	noBtn.TextSize = 20
	noBtn.Text = "No"
	local noCorner = Instance.new("UICorner", noBtn)
	noCorner.CornerRadius = UDim.new(0, 12)

	yesBtn.MouseButton1Click:Connect(function()
		promptGui:Destroy()
		callback(true)
	end)

	noBtn.MouseButton1Click:Connect(function()
		promptGui:Destroy()
		callback(false)
	end)
end

--// Load the Stealing Utils GUI after the prompt
showInstantStealPrompt(function(enableInstantSteal)
	if enableInstantSteal then
		startInstantSteal()
	end

	--// Stealing Utils GUI
	local gui = Instance.new("ScreenGui")
	gui.Name = "StealingUtilsGui"
	gui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
	gui.IgnoreGuiInset = true
	gui.ResetOnSpawn = false
	gui.Parent = player:WaitForChild("PlayerGui")

	local blur = Instance.new("BlurEffect")
	blur.Size = 0
	blur.Parent = Lighting

	local bgFrame = Instance.new("Frame")
	bgFrame.Parent = gui
	bgFrame.Size = UDim2.new(1, 0, 1, 0)
	bgFrame.BackgroundTransparency = 1
	local bgGradient = Instance.new("UIGradient", bgFrame)
	bgGradient.Color = ColorSequence.new{
		ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 160, 130)),
		ColorSequenceKeypoint.new(0.5, Color3.fromRGB(100, 150, 255)),
		ColorSequenceKeypoint.new(1, Color3.fromRGB(255, 220, 200))
	}
	bgGradient.Rotation = 45

	local frame = Instance.new("Frame")
	frame.Parent = gui
	frame.Size = UDim2.new(0, 420, 0, 260)
	frame.Position = UDim2.new(0.5, 0, 0.5, 0)
	frame.AnchorPoint = Vector2.new(0.5, 0.5)
	frame.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
	frame.BackgroundTransparency = 0.55
	frame.BorderSizePixel = 0
	frame.Active = true
	frame.Draggable = true

	local corner = Instance.new("UICorner", frame)
	corner.CornerRadius = UDim.new(0, 20)

	local gradient = Instance.new("UIGradient", frame)
	gradient.Color = ColorSequence.new{
		ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 180, 130)),
		ColorSequenceKeypoint.new(1, Color3.fromRGB(90, 140, 255))
	}
	gradient.Rotation = 45

	local closeBtn = Instance.new("TextButton")
	closeBtn.Parent = frame
	closeBtn.Text = "X"
	closeBtn.Size = UDim2.new(0, 30, 0, 30)
	closeBtn.Position = UDim2.new(1, -40, 0, 10)
	closeBtn.BackgroundTransparency = 0.8
	closeBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
	closeBtn.Font = Enum.Font.GothamBold
	closeBtn.TextSize = 20
	local closeCorner = Instance.new("UICorner", closeBtn)
	closeCorner.CornerRadius = UDim.new(1, 0)

	local tooltip = Instance.new("TextLabel")
	tooltip.Parent = closeBtn
	tooltip.Text = "Close"
	tooltip.BackgroundTransparency = 1
	tooltip.TextColor3 = Color3.fromRGB(255, 255, 255)
	tooltip.TextSize = 12
	tooltip.Position = UDim2.new(-0.3, 0, 1, 0)
	tooltip.Visible = false

	closeBtn.MouseEnter:Connect(function()
		closeBtn.BackgroundTransparency = 0.5
		tooltip.Visible = true
	end)
	closeBtn.MouseLeave:Connect(function()
		closeBtn.BackgroundTransparency = 0.8
		tooltip.Visible = false
	end)
	closeBtn.MouseButton1Click:Connect(function()
		gui:Destroy()
		blur:Destroy()
	end)

	local title = Instance.new("TextLabel")
	title.Parent = frame
	title.Size = UDim2.new(1, 0, 0, 40)
	title.Position = UDim2.new(0, 0, 0, 10)
	title.BackgroundTransparency = 1
	title.TextColor3 = Color3.fromRGB(255, 255, 255)
	title.Font = Enum.Font.GothamBold
	title.TextSize = 24
	title.Text = "Stealing Utils"

	local statusLabel = Instance.new("TextLabel")
	statusLabel.Parent = frame
	statusLabel.Size = UDim2.new(1, 0, 0, 30)
	statusLabel.Position = UDim2.new(0, 0, 1, -40)
	statusLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
	statusLabel.Font = Enum.Font.Gotham
	statusLabel.TextSize = 18
	statusLabel.BackgroundTransparency = 1
	statusLabel.Text = "Ready To Use!"

	-- Action button
	local actionBtn = Instance.new("TextButton")
	actionBtn.Parent = frame
	actionBtn.Size = UDim2.new(0, 200, 0, 50)
	actionBtn.Position = UDim2.new(0.5, -100, 0, 70)
	actionBtn.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
	actionBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
	actionBtn.Font = Enum.Font.GothamBold
	actionBtn.TextSize = 20
	actionBtn.Text = "Stealing Util"
	local actionCorner = Instance.new("UICorner", actionBtn)
	actionCorner.CornerRadius = UDim.new(0, 12)

	-- Choose Base button
	local chooseBaseBtn = Instance.new("TextButton")
	chooseBaseBtn.Parent = frame
	chooseBaseBtn.Size = UDim2.new(0, 200, 0, 50)
	chooseBaseBtn.Position = UDim2.new(0.5, -100, 0, 130)
	chooseBaseBtn.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
	chooseBaseBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
	chooseBaseBtn.Font = Enum.Font.GothamBold
	chooseBaseBtn.TextSize = 20
	chooseBaseBtn.Text = "Choose Base"
	local baseCorner = Instance.new("UICorner", chooseBaseBtn)
	baseCorner.CornerRadius = UDim.new(0, 12)

	local basePositions = {Vector3.new(-124.87,4.12,-122.90), Vector3.new(-125.94,3.51,-171.55)}

	-- Stealing util functionality
	local currentTween
	local running = false

	local function stopTween()
		if currentTween then
			currentTween:Cancel()
			currentTween = nil
		end
	end

	actionBtn.MouseButton1Click:Connect(function()
		if not running then
			running = true
			actionBtn.Text = "Stop Stealing Util"
			statusLabel.Text = "Active"

			coroutine.wrap(function()
				local character = player.Character
				if character and character:FindFirstChild("HumanoidRootPart") then
					local hrp = character.HumanoidRootPart
					local firstTween = TweenService:Create(hrp, TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {CFrame = CFrame.new(basePositions[1])})
					firstTween:Play()
					firstTween.Completed:Wait()

					local secondTween = TweenService:Create(hrp, TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {CFrame = CFrame.new(basePositions[2])})
					secondTween:Play()
					secondTween.Completed:Wait()
				end

				running = false
				actionBtn.Text = "Stealing Util"
				statusLabel.Text = "Ready To Use!"
			end)()
		else
			running = false
			stopTween()
			actionBtn.Text = "Stealing Util"
			statusLabel.Text = "Ready To Use!"
		end
	end)

	-- Base Selector GUI
	chooseBaseBtn.MouseButton1Click:Connect(function()
		local baseGui = Instance.new("ScreenGui")
		baseGui.Name = "BaseSelectorGui"
		baseGui.Parent = player:WaitForChild("PlayerGui")

		local baseFrame = Instance.new("Frame")
		baseFrame.Parent = baseGui
		baseFrame.Size = UDim2.new(0, 300, 0, 450)
		baseFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
		baseFrame.AnchorPoint = Vector2.new(0.5, 0.5)
		baseFrame.BackgroundColor3 = Color3.fromRGB(50,50,50)
		baseFrame.BackgroundTransparency = 0.55
		baseFrame.BorderSizePixel = 0

		local corner = Instance.new("UICorner", baseFrame)
		corner.CornerRadius = UDim.new(0, 20)

		local gradient = Instance.new("UIGradient", baseFrame)
		gradient.Color = ColorSequence.new{
			ColorSequenceKeypoint.new(0, Color3.fromRGB(255,180,130)),
			ColorSequenceKeypoint.new(1, Color3.fromRGB(90,140,255))
		}
		gradient.Rotation = 45

		local title = Instance.new("TextLabel")
		title.Parent = baseFrame
		title.Text = "Select Base"
		title.Size = UDim2.new(1,0,0,40)
		title.Position = UDim2.new(0,0,0,10)
		title.TextColor3 = Color3.fromRGB(255,255,255)
		title.Font = Enum.Font.GothamBold
		title.TextSize = 24
		title.BackgroundTransparency = 1

		local bases = {
			{"Base 1", Vector3.new(-124.87, 4.12, -122.90), Vector3.new(-125.94, 3.51, -171.55)},
			{"Base 2", Vector3.new(-5.61, 4.20, -126.03), Vector3.new(-5.52, 3.85, -171.45)},
			{"Base 3", Vector3.new(114.14, 2.93, -123.08), Vector3.new(114.14, 2.93, -170.89)},
			{"Base 4", Vector3.new(234.41, 4.33, -124.25), Vector3.new(234.41, 4.33, -169.55)},
			{"Base 5", Vector3.new(-124.87,4.12,17.2), Vector3.new(-125.94,3.51,65.64)},
			{"Base 6", Vector3.new(-5.61,4.20,17.2), Vector3.new(-5.52,3.85,65.64)},
			{"Base 7", Vector3.new(114.14,2.93,17.2), Vector3.new(114.14,2.93,65.64)},
			{"Base 8", Vector3.new(234.41,4.33,17.2), Vector3.new(234.41,4.33,65.64)}
		}

		local baseColors = {
			Color3.fromRGB(255,0,0),
			Color3.fromRGB(0,255,0),
			Color3.fromRGB(0,0,255),
			Color3.fromRGB(255,255,0),
			Color3.fromRGB(255,0,255),
			Color3.fromRGB(0,255,255),
			Color3.fromRGB(128,0,128),
			Color3.fromRGB(255,128,0)
		}

		local tracerObjects = {}

		local function createTracer(basePosition,color)
			local part = Instance.new("Part")
			part.Anchored = true
			part.CanCollide = false
			part.Size = Vector3.new(0.2,0.2,1)
			part.Color = color
			part.Parent = Workspace
			table.insert(tracerObjects,{part=part,target=basePosition})
		end

		for i, baseInfo in ipairs(bases) do
			createTracer(baseInfo[2],baseColors[i])
		end

		local tracerConnection
		tracerConnection = RunService.RenderStepped:Connect(function()
			if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
				local hrpPos = player.Character.HumanoidRootPart.Position
				for _, t in pairs(tracerObjects) do
					local distance = (hrpPos - t.target).Magnitude
					t.part.Size = Vector3.new(0.2,0.2,distance)
					t.part.CFrame = CFrame.new((hrpPos + t.target)/2, t.target)
				end
			end
		end)

		local legendFrame = Instance.new("Frame")
		legendFrame.Parent = baseFrame
		legendFrame.Size = UDim2.new(0,120,0,220)
		legendFrame.Position = UDim2.new(1,10,0,50)
		legendFrame.BackgroundColor3 = Color3.fromRGB(40,40,40)
		legendFrame.BackgroundTransparency = 0.4
		local legendCorner = Instance.new("UICorner", legendFrame)
		legendCorner.CornerRadius = UDim.new(0,10)

		local padding = 10
		for i, baseInfo in ipairs(bases) do
			local colorLabel = Instance.new("TextLabel")
			colorLabel.Parent = legendFrame
			colorLabel.Size = UDim2.new(0,100,0,20)
			colorLabel.Position = UDim2.new(0,padding,0,padding + (i-1)*25)
			colorLabel.BackgroundColor3 = baseColors[i]
			colorLabel.BackgroundTransparency = 0.1
			colorLabel.Text = "  "..baseInfo[1]
			colorLabel.TextColor3 = Color3.fromRGB(255,255,255)
			colorLabel.Font = Enum.Font.Gotham
			colorLabel.TextSize = 14
			colorLabel.TextXAlignment = Enum.TextXAlignment.Left
		end

		for i, info in ipairs(bases) do
			local btn = Instance.new("TextButton")
			btn.Parent = baseFrame
			btn.Size = UDim2.new(0,200,0,40)
			btn.Position = UDim2.new(0.5,-100,0,60+(i-1)*50)
			btn.BackgroundColor3 = Color3.fromRGB(80,80,80)
			btn.TextColor3 = Color3.fromRGB(255,255,255)
			btn.Font = Enum.Font.Gotham
			btn.TextSize = 18
			btn.Text = info[1]
			local btnCorner = Instance.new("UICorner", btn)
			btnCorner.CornerRadius = UDim.new(0,12)

			btn.MouseButton1Click:Connect(function()
				basePositions = {info[2],info[3]}
				for _, t in pairs(tracerObjects) do
					t.part:Destroy()
				end
				tracerObjects = {}
				tracerConnection:Disconnect()
				player.Character.HumanoidRootPart.CFrame = CFrame.new(info[2])
				baseGui:Destroy()
			end)
		end
	end)
end)
